@page "/video-share/{VideoId:guid}"
@using Microsoft.AspNetCore.Components.Sections
@layout NullLayout

<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-5xl mx-auto">
        <!-- Header Card -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
            <div class="bg-gradient-to-r from-primary-600 to-primary-700 px-6 py-4">
                <h2 class="text-2xl font-bold text-white flex items-center">
                    <i class="bi bi-share-fill mr-2"></i>
                    Chi tiết Video
                </h2>
            </div>

            <div class="p-6">
                @if (Video == null)
                {
                    <div class="text-center py-12">
                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"></div>
                        <p class="mt-4 text-gray-600">Đang tải thông tin video...</p>
                    </div>
                }
                else
                {
                    <!-- Video Info Section -->
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6 pb-6 border-b border-gray-200">
                        <div class="flex-1">
                            <h3 class="text-2xl font-bold text-gray-900 mb-2">@Video.Title</h3>
                            <p class="text-gray-600 flex items-center">
                                <i class="bi bi-calendar mr-2"></i>
                                Ngày tạo: @Video.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                            </p>
                        </div>
                        <div class="flex-shrink-0">
                            <a href="/api/video/download/@Video.Id" target="_blank"
                               class="inline-flex items-center px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium shadow-md hover:shadow-lg">
                                <i class="bi bi-download mr-2"></i>
                                Download
                            </a>
                        </div>
                    </div>

                    <!-- Video Player Section -->
                    <div class="mb-6">
                        <div class="bg-black rounded-xl overflow-hidden shadow-2xl relative">
                            @{
                                var statusMessage = GetVideoStatusMessage(Video);
                            }
                            @if (statusMessage != null)
                            {
                                <div class="absolute inset-0 bg-black bg-opacity-80 flex items-center justify-center z-10">
                                    <div class="text-center">
                                        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-white mb-4"></div>
                                        <p class="text-white text-xl font-semibold">@statusMessage</p>
                                    </div>
                                </div>
                            }
                            <div id="player"
                                 data-video-player="@Video.PlayerJsMetadata"
                                 data-video-poster="@Video.Thumbnail"
                                 data-video-subtitles="@Video.SubtitleMetadata"
                                 class="w-full"
                                 style="aspect-ratio: 16/9; min-height: 400px;">
                            </div>
                        </div>
                        <div id="videoId" data-video-id="@Video.Id" class="hidden"></div>
                    </div>

                    <!-- Embed Information Section -->
                    <div class="bg-gradient-to-br from-gray-50 to-white rounded-xl p-6 border border-gray-200">
                        <h4 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <i class="bi bi-code-slash mr-2 text-primary-600"></i>
                            Thông tin nhúng
                        </h4>

                        <div class="space-y-6">
                            <!-- Embed Link -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class="bi bi-link-45deg mr-1"></i>
                                    Link nhúng:
                                </label>
                                <div class="flex gap-2">
                                    <input type="text"
                                           class="flex-1 px-4 py-2.5 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm font-mono"
                                           value=""
                                           readonly
                                           id="embedLink">
                                    <button class="px-6 py-2.5 bg-primary-600 text-white rounded-lg hover:bg-primary-700 active:bg-primary-800 transition-all duration-200 font-medium flex items-center whitespace-nowrap shadow-md hover:shadow-lg transform hover:-translate-y-0.5 active:translate-y-0"
                                            type="button"
                                            onclick="copyToClipboard('embedLink')">
                                        <i class="bi bi-clipboard mr-2"></i>
                                        Sao chép
                                    </button>
                                </div>
                            </div>

                            <!-- Iframe Code -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class="bi bi-code-square mr-1"></i>
                                    Iframe Code:
                                </label>
                                <div class="flex gap-2">
                                    <textarea class="flex-1 px-4 py-2.5 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm font-mono resize-none" 
                                              rows="3" 
                                              readonly 
                                              id="iframeCode"></textarea>
                                    <button class="px-6 py-2.5 bg-primary-600 text-white rounded-lg hover:bg-primary-700 active:bg-primary-800 transition-all duration-200 font-medium flex items-start whitespace-nowrap shadow-md hover:shadow-lg transform hover:-translate-y-0.5 active:translate-y-0"
                                            type="button"
                                            onclick="copyToClipboard('iframeCode')">
                                        <i class="bi bi-clipboard mr-2"></i>
                                        Sao chép
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<SectionContent SectionName="@SectionNames.FooterSection">
    <script src="/Components/Pages/VideoSharePage.Razor.js"></script>
</SectionContent>