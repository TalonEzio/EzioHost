<div class="lg:hidden fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200 shadow-lg">
    <!-- Bottom Navigation for Mobile -->
    <nav class="w-full">
        <div class="grid grid-cols-4 h-16">
            <a href="/" class="flex flex-col items-center justify-center @(IsActivePage("/") ? "text-primary-600 bg-primary-50" : "text-gray-600 hover:text-primary-600 hover:bg-gray-50") transition-colors">
                <i class="bi bi-house-door text-xl mb-1"></i>
                <small class="text-xs font-medium">Trang chủ</small>
            </a>
            <AuthorizeView>
                <Authorized>
                    <a href="/video" class="flex flex-col items-center justify-center @(IsActivePage("/video") ? "text-primary-600 bg-primary-50" : "text-gray-600 hover:text-primary-600 hover:bg-gray-50") transition-colors">
                        <i class="bi bi-collection-play text-xl mb-1"></i>
                        <small class="text-xs font-medium">Video</small>
                    </a>
                </Authorized>
                <NotAuthorized>
                    <a href="/login" class="flex flex-col items-center justify-center @(IsActivePage("/login") ? "text-primary-600 bg-primary-50" : "text-gray-600 hover:text-primary-600 hover:bg-gray-50") transition-colors">
                        <i class="bi bi-box-arrow-in-right text-xl mb-1"></i>
                        <small class="text-xs font-medium">Đăng nhập</small>
                    </a>
                </NotAuthorized>
            </AuthorizeView>
            <AuthorizeView>
                <Authorized>
                    <a href="/video-upload" class="flex flex-col items-center justify-center @(IsActivePage("/video-upload") ? "text-primary-600 bg-primary-50" : "text-gray-600 hover:text-primary-600 hover:bg-gray-50") transition-colors">
                        <i class="bi bi-cloud-upload text-xl mb-1"></i>
                        <small class="text-xs font-medium">Upload</small>
                    </a>
                </Authorized>
                <NotAuthorized>
                    <a href="/faq" class="flex flex-col items-center justify-center @(IsActivePage("/faq") ? "text-primary-600 bg-primary-50" : "text-gray-600 hover:text-primary-600 hover:bg-gray-50") transition-colors">
                        <i class="bi bi-question-circle text-xl mb-1"></i>
                        <small class="text-xs font-medium">FAQ</small>
                    </a>
                </NotAuthorized>
            </AuthorizeView>
            <AuthorizeView>
                <Authorized>
                    <div class="relative">
                        <button @onclick="ToggleAccountMenu" class="w-full h-full flex flex-col items-center justify-center @(IsActivePage("/profile") || IsActivePage("/settings") || IsActivePage("/statistics") ? "text-primary-600 bg-primary-50" : "text-gray-600 hover:text-primary-600 hover:bg-gray-50") transition-colors">
                            <i class="bi bi-person-circle text-xl mb-1"></i>
                            <small class="text-xs font-medium">Tài khoản</small>
                        </button>
                        @if (_showAccountMenu)
                        {
                            <div class="absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-xl border border-gray-200 overflow-hidden">
                                <a href="/profile" class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors" @onclick="() => _showAccountMenu = false">
                                    <i class="bi bi-person mr-2"></i>Hồ sơ
                                </a>
                                <a href="/statistics" class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors" @onclick="() => _showAccountMenu = false">
                                    <i class="bi bi-graph-up-arrow mr-2"></i>Thống kê
                                </a>
                                <a href="/settings" class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors" @onclick="() => _showAccountMenu = false">
                                    <i class="bi bi-gear mr-2"></i>Cài đặt
                                </a>
                                <div class="border-t border-gray-200"></div>
                                <a href="/logout" class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors" @onclick="() => _showAccountMenu = false">
                                    <i class="bi bi-box-arrow-right mr-2"></i>Đăng xuất
                                </a>
                            </div>
                        }
                    </div>
                </Authorized>
                <NotAuthorized>
                    <a href="/faq" class="flex flex-col items-center justify-center @(IsActivePage("/faq") ? "text-primary-600 bg-primary-50" : "text-gray-600 hover:text-primary-600 hover:bg-gray-50") transition-colors">
                        <i class="bi bi-question-circle text-xl mb-1"></i>
                        <small class="text-xs font-medium">FAQ</small>
                    </a>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </nav>
</div>

@code {
    [Inject] private NavigationManager Navigation { get; set; } = null!;

    private bool _showAccountMenu;

    private string CurrentPath => Navigation.Uri.Replace(Navigation.BaseUri, "").TrimStart('/');

    private bool IsActivePage(string path)
    {
        if (path == "/" && CurrentPath == "")
            return true;

        return CurrentPath.StartsWith(path.TrimStart('/'));
    }

    private void ToggleAccountMenu()
    {
        _showAccountMenu = !_showAccountMenu;
    }

}